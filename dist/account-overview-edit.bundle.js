(()=>{"use strict";function e(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function r(){var e=localStorage.getItem("user"),r=localStorage.getItem("authToken");if(!e||!r)return localStorage.removeItem("user"),localStorage.removeItem("authToken"),null;try{return JSON.parse(e)}catch(e){return localStorage.removeItem("user"),localStorage.removeItem("authToken"),null}}function a(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}window.onload=function(){var t=r();if(null!=t){t.createdAt;var o=t.displayEmail,s=(t.email,t.updatedAt,t.username);$("#Username").text(s),$("#Email").val(o),$("#save-changes-btn").on("click",(function(o){console.log("submit"),o.preventDefault();var s={};$("#email-form").serializeArray().forEach((function(e){var r=e.name,a=e.value;console.log(r),"Email"===r?s.email=(a||"").trim():"Password"===r?s.currentPassword=a:"Password-3"===r&&(s.password=a)})),s.email!==t.displayEmail&&s.email!==t.email||(s.email=null),s.password||(s.password=null);var n=function(r){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(a){e(r,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))}))}return r}({},s);$.ajax({method:"PATCH",url:"".concat(apiHost,"/api/v1/users/_me"),data:JSON.stringify(n),dataType:"json",contentType:"application/json",headers:{Authorization:"Bearer "+localStorage.getItem("authToken")},error:function(e){console.log("failure response: %O",e);var r=(e.responseJSON||{}).code;console.log("failure code="+r),"unauthorized"===r?($("#error-message").text("Authentication failed."),$("#error-message").css("display","block")):"duplicate"===r?($("#error-message").text("The email already exists."),$("#error-message").css("display","block")):"invalid_password"===r?($("#error-message").text("The password is not valid. Password must be at least 8 characters long."),$("#error-message").css("display","block")):($("#error-message").text("There was an unknown error. code=".concat(r)),$("#error-message").css("display","block"))}}).done((function(e){var a=e.email;e.username,console.log("update-user response: %O",e);var t=r();t.email=a,t.displayEmail=a,localStorage.setItem("user",JSON.stringify(t)),window.location.replace("account-overview.html")}))}))}else window.location.replace("index.html")}})();